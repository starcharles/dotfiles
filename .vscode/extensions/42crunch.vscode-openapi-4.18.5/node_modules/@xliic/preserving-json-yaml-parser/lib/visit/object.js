"use strict";
/*
 Copyright (c) 42Crunch Ltd. All rights reserved.
 Licensed under the GNU Affero General Public License version 3. See LICENSE.txt in the project root for license information.
*/
Object.defineProperty(exports, "__esModule", { value: true });
exports.visitObject = void 0;
const preserve_1 = require("../preserve");
function visitObject(parent, key, node, visitor) {
    const type = getType(node);
    if (type === "object") {
        visitor.onObjectStart(parent, key, node, (0, preserve_1.getPreservedLocation)(parent, key));
        for (const key in node) {
            visitObject(node, key, node[key], visitor);
        }
        visitor.onObjectEnd();
    }
    else if (type === "array") {
        visitor.onArrayStart(parent, key, node, (0, preserve_1.getPreservedLocation)(parent, key));
        node.forEach((value, index) => {
            visitObject(node, index, value, visitor);
        });
        visitor.onArrayEnd();
    }
    else {
        visitor.onValue(parent, key, node, (0, preserve_1.getPreservedValue)(parent, key), (0, preserve_1.getPreservedLocation)(parent, key));
    }
}
exports.visitObject = visitObject;
function getType(node) {
    if (typeof node === "object") {
        if (node === null ||
            node instanceof Number ||
            node instanceof String ||
            node instanceof Boolean) {
            return "value";
        }
        else if (node instanceof Array) {
            return "array";
        }
        return "object";
    }
    return "value";
}
