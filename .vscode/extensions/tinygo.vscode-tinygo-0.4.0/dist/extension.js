module.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t){e.exports=require("vscode")},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const o=i(0),r=i(1),s=i(5),a=i(6);let c,u;function l(){let e=u.get("tinygo-target","-");c.text="-"!=e?"TinyGo: "+e:"TinyGo",c.show()}function d(e,t){let i=e.indexOf(t);i>-1&&e.splice(i,1),e.unshift(t)}t.activate=function(e){return n(this,void 0,void 0,(function*(){let t;u=e.workspaceState,c=o.window.createStatusBarItem(o.StatusBarAlignment.Left,49),c.command="vscode-tinygo.selectTarget",l(),a.updateStatus(e),e.subscriptions.push(o.commands.registerCommand("vscode-tinygo.showPreviewToSide",t=>n(this,void 0,void 0,(function*(){a.createNewPane(e,t)})))),o.window.registerWebviewPanelSerializer("vscode-tinygo.preview",new a.PreviewSerializer(e));let i=o.commands.registerCommand("vscode-tinygo.selectTarget",()=>n(this,void 0,void 0,(function*(){if(t||(t=yield function(e){return n(this,void 0,void 0,(function*(){const t=s.promisify(r.execFile);try{const{stdout:e,stderr:n}=yield t("tinygo",["targets"]);var i=e.trimRight().split("\n")}catch(e){return o.window.showErrorMessage("Could not list TinyGo targets:\n"+e),null}i.unshift("-");let n=e.globalState.get("history")||[];for(let e=n.length-1;e>=0;e--)i.indexOf(n[e])<0||d(i,n[e]);return i}))}(e)),!t)return;const i=yield o.window.showQuickPick(t,{placeHolder:"pick a target..."});if(!i)return;let c="",u="",p="",f="";if("-"!=i){try{const e=s.promisify(r.execFile),{stdout:t,stderr:n}=yield e("tinygo",["info",i]);t.trimRight().split("\n").forEach(e=>{let t=e.indexOf(":");if(t<0)return;let i=e.substr(0,t).trim(),n=e.substr(t+1).trim();"cached GOROOT"==i?p=n:"build tags"==i?f=n:"GOOS"==i?c=n:"GOARCH"==i&&(u=n)})}catch(e){return void o.window.showErrorMessage(`Could not run 'tinygo info ${i}':\n`+e)}if(!f)return void o.window.showErrorMessage(`Could not find build tags for ${i}.`);if(!p)return void o.window.showErrorMessage(`Could not find GOROOT variable for ${i}, perhaps you have an older TinyGo version?`)}const v=o.workspace.getConfiguration("go",null);let w=v.get("toolsEnvVars",{});w.GOOS=c||void 0,w.GOARCH=u||void 0,w.GOROOT=p||void 0,w.GOFLAGS=f?"-tags="+f.split(" ").join(","):void 0,v.update("toolsEnvVars",w,o.ConfigurationTarget.Workspace),e.workspaceState.update("tinygo-target",i),l(),a.updateStatus(e),d(t,i);let g=e.globalState.get("history")||[];d(g,i),e.globalState.update("history",g)})));e.subscriptions.push(i)}))},t.deactivate=function(){c.dispose()}},function(e,t){e.exports=require("util")},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewSerializer=t.createNewPane=t.updateStatus=void 0;const o=i(0),r=i(2),s=i(7),a=i(3),c=i(8);let u=["arduino","arduino-nano33","circuitplay-bluefruit","circuitplay-express","hifive1b","microbit","pinetime-devkit0","reelboard"];t.updateStatus=function(e){let t=e.workspaceState.get("tinygo-target","-");o.commands.executeCommand("setContext","tinygoHasPreview",function(e){return!!u.includes(e)}(t))},t.createNewPane=function(e,t){return n(this,void 0,void 0,(function*(){if("file"!==t.scheme)return void o.window.showErrorMessage("Cannot preview non-local packages.");let i=r.dirname(t.fsPath);const n=o.window.createWebviewPanel("vscode-tinygo.preview","TinyGo Preview",o.ViewColumn.Beside,{enableScripts:!0,localResourceRoots:[o.Uri.file(r.join(e.extensionPath,"preview"))],retainContextWhenHidden:!0});let s=e.workspaceState.get("tinygo-target","-");n.webview.postMessage({type:"start",state:{parts:{main:{location:"parts/"+s+".json",x:0,y:0}},wires:[],target:s,packageFullPath:i}}),yield l(e,n,s,i)}))};function l(e,t,i,u){return n(this,void 0,void 0,(function*(){let l=!1;const d=o.Uri.file(r.join(e.extensionPath,"preview/playground/")),p=t.webview.asWebviewUri(d);let f=yield a.promises.readFile(r.join(e.extensionPath,"preview","webview.html"),"utf8");f=f.replace("{PLAYGROUND_PATH}",p.toString()),f=f.replace("{CSP}",`default-src 'none'; script-src ${t.webview.cspSource}; style-src ${t.webview.cspSource} 'unsafe-inline'; connect-src ${t.webview.cspSource}; font-src ${t.webview.cspSource}`),t.webview.html=f;let v=function(e){l||t.webview.postMessage(e)};t.webview.onDidReceiveMessage(e=>{"ready"===e.type?(h=e.workerConfig,m()):null==w||w.postMessage(e)}),t.onDidDispose(()=>{g&&(g.kill(),g=void 0),w&&(w.terminate(),w=void 0),y.dispose(),l=!0},null,e.subscriptions);let w,g,h,y=o.workspace.createFileSystemWatcher("**/*.go");y.onDidChange(()=>{g&&(g.kill(),g=void 0),m()},null,e.subscriptions);let m=function(){return n(this,void 0,void 0,(function*(){let n;g&&(g.kill(),g=void 0),w&&(w.terminate(),w=void 0),t.webview.postMessage({type:"compiling"}),g=new c.Compiler(e,u,[i.replace("-","_")]);try{n=yield g.compile()}catch(e){t.webview.postMessage({type:"error",message:e})}if(!n)return;let o="",a=r.join(e.extensionPath,"preview","playground","worker","webworker.js");w=new s.Worker(a,{stderr:!0}),w.addListener("message",v),w.stderr.addListener("data",e=>{o+=e.toString(),v({type:"error",message:o})}),w.addListener("error",e=>{v({type:"error",message:e.name+"\n"+e.message})}),w.postMessage({type:"start",binary:n,config:h}),w.postMessage({type:"getUpdate"})}))}}))}t.PreviewSerializer=class{constructor(e){this.context=e}deserializeWebviewPanel(e,t){return n(this,void 0,void 0,(function*(){t||e.dispose(),yield l(this.context,e,t.target,t.packageFullPath)}))}}},function(e,t){e.exports=require("worker_threads")},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Compiler=void 0;const o=i(1),r=i(2),s=i(9),a=i(3);t.Compiler=class{constructor(e,t,i){this.context=e,this.importPath=t,this.buildTags=i}compile(){return n(this,void 0,void 0,(function*(){const e=r.join(s.tmpdir(),"vscode-tinygo-build-"+(1e12*Math.random()).toFixed()+".wasm");try{let t=new Promise((t,i)=>{this.process=o.execFile("tinygo",["build","-tags="+this.buildTags.join(","),"-opt=1","-no-debug","-o="+e],{cwd:this.importPath},(e,n,o)=>{e?i(o):t(void 0)})});return yield t,yield a.promises.readFile(e)}finally{try{a.promises.unlink(e)}catch(e){}}}))}kill(){this.process&&(this.process.kill(),this.process=void 0)}}},function(e,t){e.exports=require("os")}]);
//# sourceMappingURL=extension.js.map